<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submariner Range Calculation Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { Application, Controller } from "https://unpkg.com/@hotwired/stimulus/dist/stimulus.js"
        window.Stimulus = Application.start()

        // Ship Data Controller
        class ShipDataController extends Controller {
            static values = { ships: Array }

            connect() {
                this.shipsValue = [
                    { name: "Small Fishing Vessel", height: 20 },
                    { name: "Large Fishing Vessel", height: 50 },
                    { name: "Warship 110", height: 110 },
                    { name: "Warship 40", height: 40 },
                    { name: "Small Merchant Vessel", height: 80 },
                    { name: "Medium Merchant Vessel", height: 60 },
                    { name: "Large Merchant Vessel", height: 150 },
                    { name: "VL MV 200", height: 200 },
                ];
            }

            getRandomShip() {
                const randomIndex = Math.floor(Math.random() * this.shipsValue.length);
                return this.shipsValue[randomIndex];
            }
        }

        // Calculation Controller
        class CalculationController extends Controller {
            static targets = ["shipName", "shipHeight", "minutesPulled", "userInput", "nextButton", "correctAnswer"]
            static outlets = ["ship-data", "feedback"]
            static values = { currentShip: Object, minutesPulled: Number, correctAnswer: Number }

            connect() {
                this.generateNewProblem();
            }

            generateNewProblem() {
                // Get random ship from ship-data controller
                this.currentShipValue = this.shipDataOutlet.getRandomShip();
                
                // Generate random minutes pulled (2-30)
                this.minutesPulledValue = Math.floor(Math.random() * 29) + 2;
                
                // Calculate correct answer - round (height/minutes) to 1 decimal place first
                const heightOverMinutes = this.currentShipValue.height / this.minutesPulledValue;
                const roundedHeightOverMinutes = Math.round(heightOverMinutes * 10) / 10;
                this.correctAnswerValue = roundedHeightOverMinutes * 1000;
                
                // Update display
                this.updateDisplay();
                
                // Clear user input
                this.userInputTarget.value = "";
                
                // Reset feedback
                this.feedbackOutlet.reset();
            }

            updateDisplay() {
                this.shipNameTarget.textContent = this.currentShipValue.name;
                this.shipHeightTarget.textContent = this.currentShipValue.height;
                this.minutesPulledTarget.textContent = this.minutesPulledValue;
                this.correctAnswerTarget.textContent = this.correctAnswerValue;
            }

            checkAnswer() {
                const userAnswer = parseFloat(this.userInputTarget.value);
                
                if (isNaN(userAnswer)) {
                    this.feedbackOutlet.showError("Please enter a valid number");
                    return;
                }

                if (userAnswer === this.correctAnswerValue) {
                    this.feedbackOutlet.showSuccess();
                    this.nextButtonTarget.classList.remove("hidden");
                } else {
                    this.feedbackOutlet.showError("Incorrect. Try again!");
                    this.nextButtonTarget.classList.add("hidden");
                }
            }

            nextProblem() {
                this.generateNewProblem();
                this.nextButtonTarget.classList.add("hidden");
            }
        }

        // Feedback Controller
        class FeedbackController extends Controller {
            static targets = ["message", "container"]

            showSuccess() {
                this.containerTarget.className = "mt-4 p-4 rounded-lg bg-green-100 border border-green-400";
                this.messageTarget.textContent = "Correct! Well done.";
                this.messageTarget.className = "text-green-700 font-semibold";
            }

            showError(message) {
                this.containerTarget.className = "mt-4 p-4 rounded-lg bg-red-100 border border-red-400";
                this.messageTarget.textContent = message;
                this.messageTarget.className = "text-red-700 font-semibold";
            }

            reset() {
                this.containerTarget.className = "mt-4 p-4 rounded-lg hidden";
                this.messageTarget.textContent = "";
            }
        }

        // Register controllers
        Stimulus.register("ship-data", ShipDataController)
        Stimulus.register("calculation", CalculationController)
        Stimulus.register("feedback", FeedbackController)
    </script>
</head>
<body class="bg-gray-100 min-h-screen py-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">
            Submariner Range Calculation Test
        </h1>
        
        <!-- Ship Data Controller (hidden, just for data management) -->
        <div data-controller="ship-data" class="hidden ship-data-controller"></div>
        
        <!-- Main Application -->
        <div data-controller="calculation feedback" 
             data-calculation-ship-data-outlet=".ship-data-controller"
             data-calculation-feedback-outlet=".feedback-controller"
             class="space-y-6">
            
            <!-- Problem Display -->
            <div class="bg-blue-50 p-6 rounded-lg border border-blue-200">
                <h2 class="text-xl font-semibold text-blue-800 mb-4">Current Problem</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                    <div class="bg-white p-4 rounded border">
                        <div class="text-sm text-gray-600 mb-1">Ship Type</div>
                        <div class="font-bold text-lg" data-calculation-target="shipName">-</div>
                    </div>
                    
                    <div class="bg-white p-4 rounded border">
                        <div class="text-sm text-gray-600 mb-1">Ship Height (feet)</div>
                        <div class="font-bold text-lg" data-calculation-target="shipHeight">-</div>
                    </div>
                    
                    <div class="bg-white p-4 rounded border">
                        <div class="text-sm text-gray-600 mb-1">Minutes Pulled</div>
                        <div class="font-bold text-lg" data-calculation-target="minutesPulled">-</div>
                    </div>
                </div>
            </div>
            
            <!-- Formula Display -->
            <div class="bg-gray-50 p-4 rounded-lg border">
                <div class="text-center">
                    <div class="text-sm text-gray-600 mb-2">Formula:</div>
                    <div class="font-mono text-lg font-semibold">
                        Range = (Ship Height ÷ Minutes Pulled) × 1000
                    </div>
                </div>
            </div>
            
            <!-- User Input -->
            <div class="space-y-4">
                <label for="userAnswer" class="block text-lg font-semibold text-gray-700">
                    Calculate the Range:
                </label>
                
                <div class="flex gap-4 items-center">
                    <input 
                        type="number" 
                        id="userAnswer"
                        data-calculation-target="userInput"
                        class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-lg"
                        placeholder="Enter your answer"
                        step="any"
                    >
                    
                    <button 
                        data-action="click->calculation#checkAnswer"
                        class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"
                    >
                        Check Answer
                    </button>
                </div>
                
                <!-- Testing: Show Correct Answer -->
                <div class="mt-2 p-3 bg-yellow-100 border border-yellow-300 rounded-lg">
                    <div class="text-sm text-yellow-700">
                        <strong>Expected Answer (for testing):</strong> 
                        <span data-calculation-target="correctAnswer" class="font-mono">-</span>
                    </div>
                </div>
            </div>
            
            <!-- Feedback Area -->
            <div data-controller="feedback" class="feedback-controller">
                <div data-feedback-target="container" class="mt-4 p-4 rounded-lg hidden">
                    <div data-feedback-target="message"></div>
                </div>
            </div>
            
            <!-- Next Button -->
            <div class="text-center">
                <button 
                    data-calculation-target="nextButton"
                    data-action="click->calculation#nextProblem"
                    class="hidden px-8 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors"
                >
                    Next Problem
                </button>
            </div>
        </div>
        
        <!-- Instructions -->
        <div class="mt-8 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
            <h3 class="font-semibold text-yellow-800 mb-2">Instructions:</h3>
            <ul class="text-sm text-yellow-700 space-y-1">
                <li>• Use the formula to calculate the range based on ship height and minutes pulled</li>
                <li>• Enter your answer and click "Check Answer"</li>
                <li>• Correct answers will show in green with a "Next Problem" button</li>
                <li>• Incorrect answers will show in red - try again with the same problem</li>
            </ul>
        </div>
    </div>
</body>
</html>
